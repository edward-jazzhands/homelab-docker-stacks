services:
  pihole:
    cap_add:
      - CHOWN
      - DAC_OVERRIDE
      - FOWNER
      - KILL
      - NET_ADMIN
      - NET_BIND_SERVICE
      - NET_RAW
      - SETFCAP
      - SETGID
      - SETPCAP
      - SETUID
      - SYS_NICE
      - SYS_TIME
    cap_drop:
      - ALL
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: 4096M
    environment:
      FTLCONF_dns_listeningMode: all
      FTLCONF_webserver_api_password: ${PASSWORD}
      FTLCONF_webserver_port: "20720"
      NVIDIA_VISIBLE_DEVICES: void
      TZ: America/Los_Angeles
      UMASK: "002"
      UMASK_SET: "002"
    group_add:
      - 1000
      - 568
    healthcheck:
      interval: 30s
      retries: 5
      start_interval: 2s
      start_period: 15s
      test:
        - CMD
        - timeout
        - "1"
        - bash
        - -c
        - cat < /dev/null > /dev/tcp/127.0.0.1/20720
      timeout: 5s
    image: pihole/pihole:2025.11.1
    platform: linux/amd64
    ports:
      - mode: ingress
        protocol: tcp
        published: 20720
        target: 20720
      - mode: ingress
        protocol: tcp
        published: 53
        target: 53
      - mode: ingress
        protocol: udp
        published: 53
        target: 53
    privileged: false
    restart: unless-stopped
    shm_size: 64M
    stdin_open: false
    tty: false
    user: 0:0
    volumes:
      - bind:
          create_host_path: false
          propagation: rprivate
        read_only: false
        source: /mnt/data_pool_1/brents-data/pihole-data/dnsmasq
        target: /etc/dnsmasq.d
        type: bind
      - bind:
          create_host_path: false
          propagation: rprivate
        read_only: false
        source: /mnt/data_pool_1/brents-data/pihole-data/config
        target: /etc/pihole
        type: bind
volumes: {}
x-portals:
  - host: 0.0.0.0
    name: Web UI
    path: /admin/
    port: 20720
    scheme: http
x-notes: |
  # Pi-hole
  ### Container: [pihole]
  #### Running user/group(s)
  - User: root - Group: root - Supplementary Groups: apps
  #### Security option [no-new-privileges] is not set
  - Processes can gain additional privileges through setuid/setgid binaries
  - Can potentially allow privilege escalation attacks within the container
networks: {}
